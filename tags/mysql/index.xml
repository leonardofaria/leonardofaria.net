<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>mysql on Leonardo Faria</title><link>http://leonardofaria.github.io/leonardofaria.net/tags/mysql/</link><description>Recent content in mysql on Leonardo Faria</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 01 Dec 2014 21:46:07 -0200</lastBuildDate><atom:link href="http://leonardofaria.github.io/leonardofaria.net/tags/mysql/index.xml" rel="self" type="application/rss+xml"/><item><title>Curiosidade MySQL do dia: senhas em scripts</title><link>http://leonardofaria.github.io/leonardofaria.net/2014/12/01/curiosidade-mysql-do-dia-senhas-em-scripts/</link><pubDate>Mon, 01 Dec 2014 21:46:07 -0200</pubDate><guid>http://leonardofaria.github.io/leonardofaria.net/2014/12/01/curiosidade-mysql-do-dia-senhas-em-scripts/</guid><description>&lt;p>Sempre que você está executando um script automatizado que usa o MySQL você possivelmente se pergunta como aplicará alguma boa prática para evitar a inserção de senha diretamente no shell.&lt;/p>
&lt;p>Fiz uma pesquisa rápida sobre o assunto e encontrei duas soluções:&lt;/p>
&lt;h3 id="1-variáveis">1) Variáveis&lt;/h3>
&lt;p>Você pode usar a variável &lt;code>MYSQL_PWD&lt;/code> para armazenar uma senha de conexão com o banco. Exemplo:&lt;/p>
&lt;pre>&lt;code>export MYSQL_PWD=mypassword
mysql -h127.0.0.1 -uuser -e &amp;quot;show processlist&amp;quot;
&lt;/code>&lt;/pre>&lt;p>No caso acima o &lt;code>mysql&lt;/code> está sendo usado sem a opção &lt;code>-p&lt;/code>, que é opção utilizada para informar a senha do banco. O comando só é executado com sucesso pois o MySQL automaticamente identifica a variável &lt;code>MYSQL_PWD&lt;/code>. Utilizei a opção &lt;code>-e&lt;/code> para executar via shell o comando &lt;code>show processlist&lt;/code>, que lista as queries em processamento no momento.&lt;/p>
&lt;h3 id="2-arquivo-adicional-de-configuração">2) Arquivo adicional de configuração&lt;/h3>
&lt;p>Outra &lt;a href="http://dev.mysql.com/doc/refman/5.5/en/password-security-user.html">opção interessante&lt;/a> é criar um arquivo &lt;code>.my.cnf&lt;/code> com os parâmetros de conexão com o banco e guardá-lo em sua pasta de usuário. Exemplo:&lt;/p>
&lt;pre>&lt;code>[client]
host=127.0.0.1
user=myuser
password=mypassword
&lt;/code>&lt;/pre>&lt;p>Lembre-se de dar permissão de acesso a esse arquivo somente para o seu usuário:&lt;/p>
&lt;pre>&lt;code>chmod 600 .my.cnf
&lt;/code>&lt;/pre>&lt;p>Feito isso, quando necessário executar o &lt;code>mysql&lt;/code>, basta informar as credenciais de conexão do seu arquivo:&lt;/p>
&lt;pre>&lt;code>mysql --defaults-extra-file=.my.cnf -e &amp;quot;show processlist&amp;quot;
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Atenção:&lt;/strong> Lembre-se sempre de rever as permissões do usuário do MySQL que executará scripts. Evite sempre dar privilégios a mais e assim você poderá evitar grandes tragédias :)&lt;/p></description></item><item><title>mytop, para monitorar seu MySQL</title><link>http://leonardofaria.github.io/leonardofaria.net/2012/10/04/mytop-para-monitorar-seu-mysql/</link><pubDate>Thu, 04 Oct 2012 00:27:33 -0300</pubDate><guid>http://leonardofaria.github.io/leonardofaria.net/2012/10/04/mytop-para-monitorar-seu-mysql/</guid><description>&lt;p>O &lt;a href="http://jeremy.zawodny.com/mysql/mytop/">mytop&lt;/a> é um clone do comando top para o MySQL. Ele é usado para monitorar a performance do seu banco, sem precisar de softwares caros, complexos ou pesados. Ele é escrito em Perl e abaixo está um mini-roteiro de como instalá-lo – no meu caso, Mac OS Mountain Lion.&lt;/p>
&lt;center>
&lt;a href="http://jeremy.zawodny.com/mysql/mytop/">&lt;img src="http://leonardofaria.github.io/leonardofaria.net/wp-content/uploads/2012/10/mytop.jpg" alt="" title="mytop" />&lt;/a>
&lt;/center>
&lt;p>Antes de compilar o mytop é necessário &lt;a href="https://discussions.apple.com/thread/3136351?start=0&amp;amp;tstart=0">instalar o pré-requisito DBD-Mysql&lt;/a>. No terminal, digite:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">perl -MCPAN -e 'shell'
&lt;/pre>
&lt;p>Em seguida, execute:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">get DBD::mysql
exit
&lt;/pre>
&lt;p>Ao sair do prompt do cpan, digite:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">cd ~/.cpan/build/DBD-mysql-&lt;version>/
perl Makefile.PL--testuser='mysql_user_name' --testpassword='mysql_passwd'
make
make test
make install
&lt;/pre>
&lt;p>Faça o &lt;a href="http://jeremy.zawodny.com/mysql/mytop/mytop-1.6.tar.gz">download do pacote&lt;/a> porque já é hora de compilá-lo:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">tar -zxvf mytop-&lt;version>.tar.gz
cd mytop-&lt;version>
perl Makefile.PL
make
make test
make install
&lt;/pre>
&lt;p>Execute o mytop pela primeira vez:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">mytop&lt;/pre>
&lt;p>Pode acontecer o seguinte erro:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">Error in option spec: "long|!"&lt;/pre>
&lt;p>Caso esse erro aconteça, é necessário editarmos o mytop. Abra o arquivo – aqui instalado em /usr/local/bin e edite a linha 159:&lt;/p>
&lt;pre class="brush: perl; title: ; notranslate" title="">"long|long_nums|l!" => \$config{long_nums},&lt;/pre>
&lt;p>Além disso, substitua as linhas 958 e 959 pelas linhas seguintes:&lt;/p>
&lt;pre class="brush: perl; title: ; notranslate" title="">if ($host)
{
$host =~ s/^([^.]+).*/$1/;
$thread->{Host} = $host;
}
&lt;/pre>
&lt;h2 id="usando-o-mytop">Usando o mytop&lt;/h2>
&lt;p>Você pode monitorar seu banco passando as configurações de conexão via shell:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">mytop -u 'seuusuario' -p 'suasenha' -h 127.0.0.1 -d 'seubanco'&lt;/pre>
&lt;p>…ou pode criar um arquivo .mytop em sua pasta de usuários, como o abaixo:&lt;/p>
&lt;pre class="brush: plain; title: ; notranslate" title="">user=seuusuario
pass=suasenha
host=127.0.0.1
db=seubanco&lt;/pre></description></item><item><title>Alternativas ao PHPMyAdmin</title><link>http://leonardofaria.github.io/leonardofaria.net/2009/08/22/alternativas-ao-phpmyadmin/</link><pubDate>Sat, 22 Aug 2009 16:32:36 -0300</pubDate><guid>http://leonardofaria.github.io/leonardofaria.net/2009/08/22/alternativas-ao-phpmyadmin/</guid><description>&lt;p>O &lt;a href="http://www.phpmyadmin.net/">&lt;strong>PHPMyAdmin&lt;/strong>&lt;/a> é quase uma unanimidade em gerenciadores de banco de dados MySQL. Mas existe vida além dele. Vamos lá:&lt;/p>
&lt;h3 id="sql-buddy">SQL Buddy&lt;/h3>
&lt;p>O &lt;a href="http://www.sqlbuddy.com/">&lt;strong>SQL Buddy&lt;/strong>&lt;/a> é uma alternativa bacana, com bonita interface e traduzido para vários idiomas, incluindo português.&lt;/p>
&lt;center>
&lt;a href="http://www.sqlbuddy.com/">&lt;img src="http://leonardofaria.github.io/leonardofaria.net/wp-content/uploads/2009/08/sqlbuddy.jpg" alt="sqlbuddy" title="sqlbuddy" />&lt;/a>
&lt;/center>
&lt;h3 id="adminer">Adminer&lt;/h3>
&lt;p>Já o &lt;strong>&lt;a href="http://www.adminer.org/">Adminer&lt;/a>&lt;/strong> é um app em php feito em 1(!) único arquivo. Possui diversas traduções (nenhuma ainda em português) mas é altamente indicado o mantermos em nossos servidores para uma rápida manutenção.&lt;/p>
&lt;center>
&lt;a href="http://www.adminer.org/">&lt;img src="http://leonardofaria.github.io/leonardofaria.net/wp-content/uploads/2009/08/adminer.png" alt="adminer" title="adminer" />&lt;/a>
&lt;/center></description></item><item><title>Descubra de onde vem seus usuários com SQL</title><link>http://leonardofaria.github.io/leonardofaria.net/2009/07/12/descubra-de-onde-vem-seus-usuarios-com-sql/</link><pubDate>Sun, 12 Jul 2009 17:51:44 -0300</pubDate><guid>http://leonardofaria.github.io/leonardofaria.net/2009/07/12/descubra-de-onde-vem-seus-usuarios-com-sql/</guid><description>&lt;p>Tenho no &lt;a href="http://www.autosimulado.com.br">&lt;strong>autosimulado&lt;/strong>&lt;/a> algumas queries para acompanhar a evolução dos usuários do site. Periodicamente, vejo o número de usuários criados dia-a-dia no site e o número de testes realizados por esses usuários.&lt;/p>
&lt;p>Relacionado as essas queries, &lt;a href="http://www.mendable.com/sql-trick-where-are-your-users-from/">vi uma interessante consulta&lt;/a> para agrupar o número de usuários por domínio de email, através da função &lt;a href="http://dev.mysql.com/doc/refman/5.1/en/string-functions.html#function_substring-index">substring&lt;/a>. Confira:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sql" data-lang="sql">&lt;span style="color:#000;font-weight:bold">SELECT&lt;/span> &lt;span style="color:#000;font-weight:bold">COUNT&lt;/span>(&lt;span style="color:#000;font-weight:bold">*&lt;/span>) &lt;span style="color:#000;font-weight:bold">AS&lt;/span> Total, SUBSTRING_INDEX(email, &lt;span style="color:#d14">&amp;#39;@&amp;#39;&lt;/span>, &lt;span style="color:#000;font-weight:bold">-&lt;/span>&lt;span style="color:#099">1&lt;/span>) &lt;span style="color:#000;font-weight:bold">AS&lt;/span> &lt;span style="color:#000;font-weight:bold">Domain&lt;/span> &lt;span style="color:#000;font-weight:bold">FROM&lt;/span> users
&lt;span style="color:#000;font-weight:bold">GROUP&lt;/span> &lt;span style="color:#000;font-weight:bold">BY&lt;/span> SUBSTRING_INDEX(email, &lt;span style="color:#d14">&amp;#39;@&amp;#39;&lt;/span>, &lt;span style="color:#000;font-weight:bold">-&lt;/span>&lt;span style="color:#099">1&lt;/span>) &lt;span style="color:#000;font-weight:bold">ORDER&lt;/span> &lt;span style="color:#000;font-weight:bold">BY&lt;/span> &lt;span style="color:#000;font-weight:bold">COUNT&lt;/span>(&lt;span style="color:#000;font-weight:bold">*&lt;/span>) &lt;span style="color:#000;font-weight:bold">DESC&lt;/span> &lt;span style="color:#000;font-weight:bold">LIMIT&lt;/span> &lt;span style="color:#099">10&lt;/span>;
&lt;/code>&lt;/pre>&lt;/div>&lt;p>O resultado, quando aplicado ao banco de dados do &lt;a href="http://www.autosimulado.com.br">&lt;strong>autosimulado&lt;/strong>&lt;/a>:&lt;/p>
&lt;pre>&lt;code>+-------+----------------+
| Total | Domain |
+-------+----------------+
| 644 | hotmail.com |
| 116 | gmail.com |
| 98 | yahoo.com.br |
| 37 | bol.com.br |
| 33 | ig.com.br |
| 15 | uol.com.br |
| 11 | oi.com.br |
| 10 | yahoo.com |
| 9 | hotmail.com.br |
| 8 | terra.com.br |
+-------+----------------+
10 rows in set (0.00 sec)
&lt;/code>&lt;/pre></description></item></channel></rss>